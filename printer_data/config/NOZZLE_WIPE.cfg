[gcode_macro NOZZLE_WIPE]
description: Wisch-Makro in V-Form fuer Drucker 2 (Y350-Y355)
gcode:
    # ----- KONFIGURATION (Drucker 2) -----
    {% set brush_x = 247 %}       ; Start X (Links)
    {% set wipe_dist = 36 %}      ; Gesamte Wischlänge in X
    
    # Y-Bereich (V-Form geht von 355 runter auf 350 und zurück)
    {% set brush_y_min = 350 %}   ; Vorne (Spitze des V)
    {% set brush_y_max = 355 %}   ; Hinten (Start/Ende des V)

    {% set brush_z = 2.0 %}       ; Eintauch-Höhe
    {% set wipe_qty = 5 %}        ; Anzahl der kompletten Durchgänge
    {% set wipe_spd = 5000 %}     ; Geschwindigkeit
    # -------------------------------------

    # Sicherheitscheck
    {% if "xyz" not in printer.toolhead.homed_axes %}
      {action_respond_info("Drucker nicht gehomed!")}
      G28
    {% endif %}

    SAVE_GCODE_STATE NAME=NOZZLE_WIPE
    G90 

    # 1. Anfahrt (Sicherheitsabstand)
    G1 Z{brush_z + 5} F3000 
    
    # Fahre zur Startposition: LINKS HINTEN (Start des V)
    G1 X{brush_x} Y{brush_y_max} F6000

    # 2. Eintauchen
    G1 Z{brush_z} F3000

    # 3. V-Form Wischen
    {% for i in range(wipe_qty) %}
        # --- HINWEG (Zeichnet ein V) ---
        # Teil 1: Zur Mitte und nach VORNE (Spitze des V)
        G1 X{brush_x + (wipe_dist / 2)} Y{brush_y_min} F{wipe_spd}
        
        # Teil 2: Zum Ende und nach HINTEN
        G1 X{brush_x + wipe_dist} Y{brush_y_max} F{wipe_spd}
        
        # --- RÜCKWEG (Zeichnet das V rückwärts) ---
        # Teil 1: Zur Mitte und nach VORNE
        G1 X{brush_x + (wipe_dist / 2)} Y{brush_y_min} F{wipe_spd}
        
        # Teil 2: Zum Start und nach HINTEN
        G1 X{brush_x} Y{brush_y_max} F{wipe_spd}
    {% endfor %}

    # 4. Wegfahren
    G1 Z{brush_z + 5} F3000
    
    RESTORE_GCODE_STATE NAME=NOZZLE_WIPE